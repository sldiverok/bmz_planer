<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ë–ú–ó –ü–ª–∞–Ω–µ—Ä</title>
<style>
  body {
    background-color: #1f1f1f;
    color: #e0e0e0;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 10px;
  }
  h1 {
    text-align: center;
    color: #00c0c4;
  }
  input, select {
    width: 100%;
    padding: 8px;
    margin: 6px 0;
    border: none;
    border-radius: 4px;
    background-color: #333;
    color: #fff;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #444;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #2b2b2b;
    cursor: pointer;
  }
  tr:nth-child(even) { background-color: #2a2a2a; }
  tr:hover { background-color: #333; }
  .footer {
    text-align: center;
    margin-top: 15px;
    font-size: 12px;
    color: #888;
  }
</style>
</head>
<body>
<h1>üìã –ë–ú–ó –ü–ª–∞–Ω–µ—Ä</h1>

<input type="text" id="searchInput" placeholder="üîé –ü–æ—à—É–∫ –ø–æ –≤—Å—ñ—Ö –ø–æ–ª—è—Ö...">
<select id="filterSelect">
  <option value="">–§—ñ–ª—å—Ç—Ä –∑–∞ –®–ü–ö</option>
</select>

<table id="dataTable">
  <thead>
    <tr>
      <th onclick="sortTable(0)">–ü–æ—Å–∞–¥–∞ ‚¨ç</th>
      <th onclick="sortTable(1)">–®–ü–ö ‚¨ç</th>
      <th onclick="sortTable(2)">–ü–Ü–ë ‚¨ç</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="footer">¬© –ë–∞—Ç–∞–ª—å–π–æ–Ω –º–∞—Ç–µ—Ä—ñ–∞–ª—å–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è</div>

<script>
const CSV_URL = "https://raw.githubusercontent.com/sldiverok/bmz_planer/main/bmz.csv";

async function loadCSV() {
  const response = await fetch(CSV_URL);
  const text = await response.text();
  const rows = text.split('\n').map(r => r.split(';'));
  
  // —à—É–∫–∞—î–º–æ –∫–æ–ª–æ–Ω–∫–∏
  const header = rows[0].map(h => h.trim());
  const posIdx = header.findIndex(h => /–ø–æ—Å–∞–¥–∞/i.test(h));
  const shpIdx = header.findIndex(h => /—à–ø–∫/i.test(h));
  const pibIdx = header.findIndex(h => /(–ø—Ä—ñ–∑–≤|–ø—ñ–±)/i.test(h));

  const tableBody = document.querySelector("#dataTable tbody");
  const filterSelect = document.getElementById("filterSelect");
  const seenShpk = new Set();

  rows.slice(1).forEach(r => {
    if (!r[posIdx] && !r[shpIdx] && !r[pibIdx]) return;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r[posIdx] || ""}</td>
      <td>${r[shpIdx] || ""}</td>
      <td>${r[pibIdx] || ""}</td>
    `;
    tableBody.appendChild(tr);

    const val = r[shpIdx]?.trim();
    if (val && !seenShpk.has(val)) {
      seenShpk.add(val);
      const opt = document.createElement("option");
      opt.value = val;
      opt.textContent = val;
      filterSelect.appendChild(opt);
    }
  });

  document.getElementById("searchInput").addEventListener("input", filterTable);
  document.getElementById("filterSelect").addEventListener("change", filterTable);
}

function filterTable() {
  const search = document.getElementById("searchInput").value.toLowerCase();
  const filter = document.getElementById("filterSelect").value.toLowerCase();
  const rows = document.querySelectorAll("#dataTable tbody tr");
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    const shpk = row.cells[1]?.textContent.toLowerCase();
    row.style.display = (text.includes(search) && (!filter || shpk === filter)) ? "" : "none";
  });
}

function sortTable(colIndex) {
  const table = document.getElementById("dataTable");
  const rows = Array.from(table.rows).slice(1);
  const asc = table.dataset.sortOrder !== "asc";
  rows.sort((a, b) => a.cells[colIndex].textContent.localeCompare(b.cells[colIndex].textContent, 'uk', {numeric:true}) * (asc ? 1 : -1));
  table.tBodies[0].append(...rows);
  table.dataset.sortOrder = asc ? "asc" : "desc";
}

loadCSV();
</script>
</body>
</html>
