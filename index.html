<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Особовий склад БМЗ</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <style>
    body {background:#1c1c1c;color:#f5f5f5;font-family:"Segoe UI",sans-serif;margin:0;padding:20px;}
    h1 {color:#00c0c4;text-align:center;margin-bottom:20px;}
    #currentUnitTitle {text-align:center;font-size:18px;margin-bottom:25px;color:#ccc;}
    table {width:100%;border-collapse:collapse;}
    th,td {border-bottom:1px solid #333;padding:10px;text-align:left;}
    th {color:#00c0c4;}
    tr:hover {background:#2b2b2b;}
    a {color:#00c0c4;text-decoration:none;}
    a:hover {text-decoration:underline;}
  </style>
</head>
<body>
  <h1>Особовий склад батальйону матеріального забезпечення</h1>
  <div id="currentUnitTitle">Завантаження даних...</div>
  <table>
    <thead><tr><th>Підрозділ</th><th>Посада</th><th>ШПК</th><th>ПІБ</th></tr></thead>
    <tbody id="soldiersBody"></tbody>
  </table>

  <script>
  const getQueryParam = n => new URL(location.href).searchParams.get(n);

  async function loadSoldiers() {
    const r = await fetch("https://raw.githubusercontent.com/sldiverok/bmz_planer/main/bmz.csv");
    const t = await r.text();
    const lines = t.split("\n").map(l=>l.trim()).filter(Boolean);
    const headers = lines[0].split(";");
    return lines.slice(1).map(line=>{
      const vals=line.split(";");
      const o={};
      headers.forEach((h,i)=>o[h.trim()]=vals[i]?vals[i].trim():"");
      return o;
    });
  }

  function renderTable(soldiers, unitCode) {
    const body=document.getElementById("soldiersBody");
    body.innerHTML="";
    const filtered=soldiers.filter(s=>(s["ПідрозділКод"]||"").trim().toUpperCase()===unitCode.trim().toUpperCase());
    if(!filtered.length){
      body.innerHTML=`<tr><td colspan="4" style="text-align:center;">Немає даних для підрозділу ${unitCode}</td></tr>`;
      return;
    }
    for(const s of filtered){
      const latin=(s["ПІБ_лат"]||"").toLowerCase();
      const link=`soldiers/${latin}.html`;
      body.innerHTML+=`
        <tr>
          <td>${s["Підрозділ"]}</td>
          <td>${s["Посада"]}</td>
          <td>${s["ШПК"]}</td>
          <td><a href="${link}">${s["ПІБ"]}</a></td>
        </tr>`;
    }
  }

  (async()=>{
    const unit=getQueryParam("unit")||sessionStorage.getItem("bmz_unit")||"";
    document.getElementById("currentUnitTitle").textContent=unit?`Підрозділ: ${unit}`:"Весь батальйон";
    const soldiers=await loadSoldiers();
    renderTable(soldiers,unit);
  })();
  </script>
</body>
</html>
